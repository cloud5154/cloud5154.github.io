<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>éƒé›¯ä»™å¥³å¾—ç¬¬ä¸€</title>
  <style>
    /* ä¿ç•™ä½ çš„æ‰€æœ‰åŸå§‹æ¨£å¼ï¼Œç•¥éä¸é‡è²¼ */
  </style>
</head>
<body>
  <div class="content">
    <h1>å“ˆå›‰ï¼éƒé›¯ä»™å¥³ ğŸ˜</h1>
    <p>ä½ æ€éº¼é€™éº¼ç”œï½</p>
    <button class="love-btn" onclick="explodeHearts(event)">ğŸ’˜ çµ¦ç”œç”œä¸€å€‹æ„›å¿ƒ</button>
    <div class="heart-count">ç›®å‰å·²æ”¶åˆ° ğŸ’– <span id="heartCount">...</span> æ¬¡æ„›å¿ƒï¼</div>
  </div>

  <div class="marquee">ğŸ’–ğŸ’–ğŸ’– è•™è³ªè˜­å¿ƒ ğŸ’–ğŸ’–ğŸ’– æ²‰é­šè½é› ğŸ’–ğŸ’–ğŸ’– å‚¾åœ‹å‚¾åŸ ğŸ’–ğŸ’–ğŸ’–</div>

  <!-- Firebase SDK v10 æ¨¡çµ„ -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBTSiMfHQMayD1mUuPWgLXZ4as5Y5epBdE",
      authDomain: "yuwen-love.firebaseapp.com",
      projectId: "yuwen-love",
      storageBucket: "yuwen-love.firebasestorage.app",
      messagingSenderId: "238940733157",
      appId: "1:238940733157:web:e1cf16192f4107d8db5e0c",
      measurementId: "G-W1MHH7RMYK"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const countRef = doc(db, "love", "heart");

    // åˆå§‹åŒ–æ„›å¿ƒæ•¸é‡
    let heartCount = 0;

    async function loadCount() {
      const docSnap = await getDoc(countRef);
      if (docSnap.exists()) {
        heartCount = docSnap.data().count;
      } else {
        await setDoc(countRef, { count: 0 });
        heartCount = 0;
      }
      document.getElementById("heartCount").innerText = heartCount;
    }

    // æ›´æ–°æ„›å¿ƒæ•¸
    async function addHeart() {
      heartCount++;
      await setDoc(countRef, { count: heartCount });
      document.getElementById("heartCount").innerText = heartCount;
    }

    // å°‡ä¸Šé¢å‡½æ•¸å‚³çµ¦å…¨åŸŸä½¿ç”¨
    window.loadCount = loadCount;
    window.addHeart = addHeart;

    // é é¢è¼‰å…¥æ™‚è®€å–ç›®å‰æ•¸é‡
    loadCount();
  </script>

  <script>
    // é£„è½æ„›å¿ƒå‹•ç•«ï¼ˆç•¥ï¼‰

    // æ„›å¿ƒçˆ†ç‚¸å‹•ç•«ï¼‹Firestore æ›´æ–°
    function explodeHearts(e) {
      const x = e.clientX;
      const y = e.clientY;
      for (let i = 0; i < 10; i++) {
        const heart = document.createElement('div');
        heart.className = 'explosion-heart';
        heart.textContent = 'ğŸ’–';
        heart.style.left = x + 'px';
        heart.style.top = y + 'px';
        const angle = Math.random() * 2 * Math.PI;
        const distance = 80 + Math.random() * 40;
        const dx = Math.cos(angle) * distance + 'px';
        const dy = Math.sin(angle) * distance + 'px';
        heart.style.setProperty('--x', dx);
        heart.style.setProperty('--y', dy);
        document.body.appendChild(heart);
        setTimeout(() => heart.remove(), 1000);
      }

      // å‘¼å« Firebase æ›´æ–°æ•¸é‡
      window.addHeart();
    }
  </script>
</body>
</html>
